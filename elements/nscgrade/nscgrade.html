<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>OpenEyes</title>
	
	<!-- CSS -->
	<link rel="stylesheet" href="../../css/openeyes.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="styles.css" type="text/css" media="screen" />

    <!--   Javascript  -->	
	<script language="JavaScript" src="../../scripts/elements.js" type="text/javascript"></script>
	
	<!-- needs EyeDraw 2 -->
    <script language="JavaScript" src="js/ED_Drawing.js" type="text/javascript"></script>
    <script language="JavaScript" src="js/ED_MedicalRetina.js" type="text/javascript"></script>
    <script language="JavaScript" src="js/ED_VitreoRetinal.js" type="text/javascript"></script>
    <script language="JavaScript" src="js/ED_Tooltips.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">

	    // Unique variable assigned to the drawing
	    var drawingEdit;
	    var drawingDisplay;
	        
        // Runs on page load
        function init()
        {
            // Get reference to the drawingEdit canvas
            var canvasEdit = document.getElementById('canvasEdit');
            
            // Create a drawingEdit
            drawingEdit = new ED.Drawing(canvasEdit, ED.eye.Right, 'RPS', true, 0, 0);
            
            // Instantiate a controller object
            var controller = new eyeDrawController(drawingEdit);
            
            // Preload any images
            drawingEdit.preLoadImagesFrom('../../graphics/');
            
            // Set focus to canvasEdit element
            canvasEdit.focus();
            
            //hidePop('grading');
        }
        
            
        // Controller class
        function eyeDrawController(_drawing)
        {
            // Assign controller properties
            this.drawing = _drawing;
            
            // Specify call back function
            this.callBack = callBack;
            
            // Register for notifications with drawing
            this.drawing.registerForNotifications(this, 'callBack', []);
            
            // Method called for notification
            function callBack(_messageArray)
            {
                //console.log("Notified for event: " + _messageArray['eventName']);

                switch (_messageArray['eventName'])
                {
                    // Eye draw image files all loaded
                    case 'ready':
                    	var doodle = this.drawing.addDoodle('PostPole', {cdRatio:'0.5'});    
                        this.drawing.deselectDoodles();
                        break;
                    case 'doodleAdded':
                        gradeCalculator();
                        break;
                    case 'doodleDeleted':
                        gradeCalculator();
                        break;
                    case 'parameter':
                        gradeCalculator();
                        break;
                    default:
                    //console.log('Unhandled notification for message: ' + _messageArray['eventName']);
                        break;
                }
            }
        }
        
        function gradeCalculator()
        {
            var doodleArray = drawingEdit.doodleArray;
            
            // Array to store counts of doodles of relevant classes
            var countArray = new Array();
            countArray['Microaneurysm'] = 0;
            countArray['HardExudate'] = 0;
            countArray['Circinate'] = 0;
            countArray['BlotHaemorrhage'] = 0;
            countArray['PreRetinalHaemorrhage'] = 0;
            countArray['CottonWoolSpot'] = 0;
            countArray['DiabeticNV'] = 0;
            countArray['FibrousProliferation'] = 0;            
            countArray['PRPPostPole'] = 0;
            
            var retinopathy = "R0"
            var maculopathy = "M0";
            
            // Get reference to PostPole doodle
            var postPole = drawingEdit.lastDoodleOfClass('PostPole');
            
            if (postPole)
            {
                // Iterate through doodles counting, and checking location
                for (var i = 0; i < doodleArray.length; i++)
                {
                    var doodle = doodleArray[i];
                    countArray[doodle.className]++;
                    
                    // Exudates within one disk diameter of fovea
                    if (doodle.className == 'HardExudate' || doodle.className == 'Circinate')
                    {
                        if (postPole.isWithinDiskDiametersOfFovea(doodle, 1)) maculopathy = 'M1';
                    }
                }
                
                // R1 (Background)
                if (countArray['Microaneurysm'] > 0 || countArray['BlotHaemorrhage'] > 0 || countArray['HardExudate'] > 0 || countArray['CottonWoolSpot'] > 0 || countArray['Circinate'] > 0)
                {
                    retinopathy = "R1";
                }
                
                // R2
                if (countArray['BlotHaemorrhage'] > 2)
                {
                    retinopathy = "R2";                        
                }
                
                // R3
                if (countArray['PRPPostPole'] > 0)
                {
                    retinopathy = "R3S";
                }
                if (countArray['DiabeticNV'] > 0 || countArray['PreRetinalHaemorrhage'] > 0 || countArray['FibrousProliferation'] > 0)
                {
                    retinopathy = "R3A";
                }
                
                // Report it
                document.getElementById('retGrade').value = retinopathy;
                gradeChange(document.getElementById('retGrade'));
                document.getElementById('macGrade').value = maculopathy;
                gradeChange(document.getElementById('macGrade'));
            }
        }

        
        function gradeChange(_obj)
        {
	        var id = _obj.id;
	        var value = _obj.value;
	        
	        var retDesc = "";
	        var macDesc = "";
	        
	        switch (value)
	        {
		        case 'R0':
		        	retDesc = "No retinopathy";
		        	document.getElementById('retGradeDesc').innerHTML = retDesc;		        	
		        	break;
		        case 'R1':
		        	retDesc = "Background retinopathy<br/>- Microaneurysms<br/>- Retinal haemorrhages<br/>- Venous loop<br/>- Any exudate in the presence of other non-referable features of DR<br/>- Any number of   cotton wool spots (CWS) in the presence of other non-referable features of DR";
		        	document.getElementById('retGradeDesc').innerHTML = retDesc;
		        	break;
		        case 'R2':
		        	retDesc = "Pre-proliferative retinopathy<br/>- Venous beading<br/>- Venous reduplication<br/>- Multiple blot haemorrhages<br/>-Intraretinal microvascular abnormality (IRMA)";
		        	document.getElementById('retGradeDesc').innerHTML = retDesc;
		        	break;
		        case 'R3A':
		        	retDesc = "Active Proliferative Retinopathy<br/>- New vessels on disc (NVD)<br/>- New vessels elsewhere (NVE)<br/>- Pre-retinal or vitreous haemorrhage<br/>- Pre-retinal fibrosis +/- tractional retinal detachment";
		        	document.getElementById('retGradeDesc').innerHTML = retDesc;
		        	break
		        case 'R3S':
		        	retDesc = "Evidence of Peripheral Retinal Laser Treatment AND<br/>Stable retina from photograph taken at or shortly after discharge from the Hospital Eye service (HES)";
		        	document.getElementById('retGradeDesc').innerHTML = retDesc;
		        	break;
		        case 'U':
		        	retDesc = "Ungradable";
		        	document.getElementById('retGradeDesc').innerHTML = retDesc;
		        	break;
		        case 'M0':
		        	macDesc = "No maculopathy";
		        	document.getElementById('macGradeDesc').innerHTML = macDesc;
		        	break;
		        case 'M1':
		        	macDesc = "Any of the following:<br/>- Exudate within 1 disc diameter (DD) of the centre of the fovea<br/>- Group of exudates within the macula<br/>- Retinal thickening within 1DD of the centre of the fovea (if stereo available)<br/>- Any microaneurysm or haemorrhage within 1DD of the centre of the fovea only if associated with a best VA of <= 6/12 (if no stereo)";
		        	document.getElementById('macGradeDesc').innerHTML = macDesc;
		        	break;
		        default:
		        	break;
	        }
        }
        
        function showPop(id)
		{
		   document.getElementById(id).style.visibility = "visible";
		}
		
		function hidePop(id)
		{
		   document.getElementById(id).style.visibility = "hidden";
		}
		
		function clickChange(obj)
		{
			if (obj.id == 'chk_adv') {
				if (obj.checked) {
					document.getElementById('advinv').style.display = "block";
					document.getElementById('advanv').style.display = "block";
					document.getElementById('advnvg').style.display = "block";
					document.getElementById('advtrd').style.display = "block";
					document.getElementById('optirm').style.display = "block";
					document.getElementById('optirs').style.display = "block";
					document.getElementById('optvbd').style.display = "block";
					document.getElementById('optvlp').style.display = "block";
					document.getElementById('optmas').style.display = "block";
					document.getElementById('optcws').style.display = "block";
				}
				else {
					document.getElementById('advinv').style.display = "none";
					document.getElementById('advanv').style.display = "none";
					document.getElementById('advnvg').style.display = "none";
					document.getElementById('advtrd').style.display = "none";
					document.getElementById('optirm').style.display = "none";
					document.getElementById('optirs').style.display = "none";
					document.getElementById('optvbd').style.display = "none";
					document.getElementById('optvlp').style.display = "none";
					document.getElementById('optmas').style.display = "none";
					document.getElementById('optcws').style.display = "none";
				}
			}
			
			if (obj.id == 'chk_prl') {
				if (obj.checked) {
					document.getElementById('prlvhm').style.display = "block";
					document.getElementById('prlprh').style.display = "block";
					document.getElementById('prlnvd').style.display = "block";
					document.getElementById('prlnve').style.display = "block";
					document.getElementById('prlprp').style.display = "block";
					document.getElementById('prlrtt').style.display = "block";
					document.getElementById('prlcms').style.display = "block";
					document.getElementById('optirm').style.display = "block";
					document.getElementById('optirs').style.display = "block";
					document.getElementById('optvbd').style.display = "block";
					document.getElementById('optvlp').style.display = "block";
					document.getElementById('optmas').style.display = "block";
					document.getElementById('optcws').style.display = "block";
				}
				else {
					document.getElementById('prlvhm').style.display = "none";
					document.getElementById('prlprh').style.display = "none";
					document.getElementById('prlnvd').style.display = "none";
					document.getElementById('prlnve').style.display = "none";
					document.getElementById('prlprp').style.display = "none";
					document.getElementById('prlrtt').style.display = "none";
					document.getElementById('prlcms').style.display = "none";
					document.getElementById('optirm').style.display = "none";
					document.getElementById('optirs').style.display = "none";
					document.getElementById('optvbd').style.display = "none";
					document.getElementById('optvlp').style.display = "none";
					document.getElementById('optmas').style.display = "none";
					document.getElementById('optcws').style.display = "none";
				}
			}
			
			if (obj.id == 'chk_nvd') {
				if (obj.checked) {
					document.getElementById('nvddes').style.display = "block";
				}
				else {
					document.getElementById('nvddes').style.display = "none";
				}
			}
			
			if (obj.id == 'chk_nve') {
				if (obj.checked) {
					document.getElementById('nvedes').style.display = "block";
				}
				else {
					document.getElementById('nvedes').style.display = "none";
				}
			}
			
			if (obj.id == 'chk_thk') {
				if (obj.checked) {
					document.getElementById('maccmo').style.display = "block";
					document.getElementById('macwit').style.display = "block";
					document.getElementById('maccen').style.display = "block";
					document.getElementById('maczon').style.display = "block";
					document.getElementById('maczth').style.display = "block";
					document.getElementById('macmns').style.display = "block";
				}
				else {
					document.getElementById('maccmo').style.display = "none";
					document.getElementById('macwit').style.display = "none";
					document.getElementById('maccen').style.display = "none";
					document.getElementById('maczon').style.display = "none";
					document.getElementById('maczth').style.display = "none";
					document.getElementById('macmns').style.display = "none";
				}
			}
			
			if (obj.id == 'chk_cen') {
				if (obj.checked) {
					document.getElementById('chk_wit').checked = true;
				}
				else {
				}
			}
			
			gradeFBCalculator();
		}
        
        function gradeFBCalculator() {//debugger
        	// Reset retinopathy
	        document.getElementById('retGradeFB').value = "R0";
	        
	        // IRMA
	        if (document.getElementById('slt_irm').value != 'None') document.getElementById('retGradeFB').value = "R2";
	        
	        // Venous beading
	        if (document.getElementById('slt_vbd').value != 'None') document.getElementById('retGradeFB').value = "R2";
	        
	        // H/Mas
	        if (document.getElementById('slt_mas').value == 1 || document.getElementById('slt_mas').value == 2) document.getElementById('retGradeFB').value = "R1";
	        if (document.getElementById('slt_mas').value >= 3) document.getElementById('retGradeFB').value = "R2";
	        
	        // CWS
	        if (document.getElementById('slt_cws').value > 0) document.getElementById('retGradeFB').value = "R1";
	        
	        // Advanced and proliferative
	        if (document.getElementById('chk_adv').checked) document.getElementById('retGradeFB').value = "R3A";
	        if (document.getElementById('chk_prl').checked) document.getElementById('retGradeFB').value = "R3A";
	        
	        // Reset maculopathy
	        document.getElementById('macGradeFB').value = "M0";
	        
	        // Mas
	        if (document.getElementById('slt_mma').value == 1 || document.getElementById('slt_mma').value == 2) document.getElementById('macGradeFB').value = "M1";
	        
	        // Exudates
	        if (document.getElementById('slt_exu').value == 1 || document.getElementById('slt_exu').value == 2 || document.getElementById('slt_exu').value == 3 || document.getElementById('slt_exu').value == 5) document.getElementById('macGradeFB').value = "M1";
	        
	        // Response to treatment
	        if (document.getElementById('slt_res').value == 2 || document.getElementById('slt_res').value == 3 || document.getElementById('slt_res').value == 4) document.getElementById('macGradeFB').value = "M1";
	        
	        // Reitnal thickening
	        if (document.getElementById('chk_thk').checked) document.getElementById('macGradeFB').value = "M1";
	        
	        // Other
	        if (document.getElementById('chk_erm').checked) document.getElementById('macGradeFB').value = "M1";
	        if (document.getElementById('chk_vmt').checked) document.getElementById('macGradeFB').value = "M1";
	        if (document.getElementById('chk_tau').checked) document.getElementById('macGradeFB').value = "M1";
	        
	        // Response to treatment
	        if (document.getElementById('slt_trs').value > 0) document.getElementById('macGradeFB').value = "M1";
        }
        
    </script>

</head>

<body onload="init();">
<div id="screen" align="center">
	<div id="content">

		
		<div class="section">
			<h4>Description:</h4>
			<p>This element records the appearance of the posterior pole of a patient with diabetes, and derives the updated NSC grade of diabetic retinopathy, displaying a description to remind users of the details of the classification.</p>
			<p>Adding doodles to the drawing will set the grade automatically, though it can be over-ridden by changing the setting of each drop down menu.</p>
			<p>Status: <b>Alpha</b></p>
		</div>

		<!-- Edit mode section -->
		<div class="section" style="height:520px;" align="left">
			<h4>Edit mode:</h4>
						
			<!-- Right eye -->
			<div style ="width: 540px; height: 160px; float:left;">
				<p>Drawing:</p>			
	            	<!-- Doodle toolbar -->
					<div class="toolbar">
						<button class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawingEdit.moveToFront(); return false;" ><img src="../../graphics/moveToFront.gif"/></button>
		                <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawingEdit.moveToBack(); return false;" ><img src="../../graphics/moveToBack.gif" /></button>
		                <button class="imgbutton" disabled="true" id="deleteSelectedDoodleRPS" title="Delete" onclick="drawingEdit.deleteSelectedDoodle(); return false;" ><img src="../../graphics/deleteSelectedDoodle.gif" /></button>
		                <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawingEdit.lock(); return false;" ><img src="../../graphics/lock.gif" /></button>
		                <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawingEdit.unlock(); return false;" ><img src="../../graphics/unlock.gif" /></button>
		                <br />
		                
                        <button class="imgbutton" title="Microaneurysm" onclick="drawingEdit.addDoodle('Microaneurysm'); return false;" ><img src="../../graphics/Microaneurysm.gif" /></button> 
                        <button class="imgbutton" title="Hard exudate" onclick="drawingEdit.addDoodle('HardExudate'); return false;" ><img src="../../graphics/HardExudate.gif" /></button>
                        <button class="imgbutton" title="Circinate" onclick="drawingEdit.addDoodle('Circinate'); return false;" ><img src="../../graphics/Circinate.gif" /></button>
                        <button class="imgbutton" title="Blot haemorrhage" onclick="drawingEdit.addDoodle('BlotHaemorrhage'); return false;" ><img src="../../graphics/BlotHaemorrhage.gif" /></button>
                        <button class="imgbutton" title="Cystoid macular oedema" onclick="drawingEdit.addDoodle('CystoidMacularOedema'); return false;" ><img src="../../graphics/CystoidMacularOedema.gif" /></button>
                        <button class="imgbutton" title="Pre-retinal haemorrhage" onclick="drawingEdit.addDoodle('PreRetinalHaemorrhage'); return false;" ><img src="../../graphics/PreRetinalHaemorrhage.gif" /></button>
                        <button class="imgbutton" title="Cotton wool spot" onclick="drawingEdit.addDoodle('CottonWoolSpot'); return false;" ><img src="../../graphics/CottonWoolSpot.gif" /></button>
                        <button class="imgbutton" title="Diabetic new vessels" onclick="drawingEdit.addDoodle('DiabeticNV'); return false;" ><img src="../../graphics/DiabeticNV.gif" /></button>
                        <button class="imgbutton" title="Fibrous proliferation" onclick="drawingEdit.addDoodle('FibrousProliferation'); return false;" ><img src="../../graphics/FibrousProliferation.gif" /></button>
                        <button class="imgbutton" title="Traction retinal detachment" onclick="drawingEdit.addDoodle('TractionRetinalDetachment'); return false;" ><img src="../../graphics/TractionRetinalDetachment.gif" /></button> 
                        <button class="imgbutton" title="IRMA" onclick="drawingEdit.addDoodle('IRMA'); return false;" ><img src="../../graphics/IRMA.gif" /></button>
                        <button class="imgbutton" title="Macular thickening" onclick="drawingEdit.addDoodle('MacularThickening'); return false;" ><img src="../../graphics/MacularThickening.gif" /></button>                                 
                        <button class="imgbutton" title="Panretinal photocoagulation" onclick="drawingEdit.addDoodle('PRPPostPole'); return false;" ><img src="../../graphics/PRPPostPole.gif" /></button>
                        <br />
	                    
	   				</div>

                    <!-- Canvas tooltip -->
                    <span id="canvasTooltip"></span>
                            
					<!-- Canvas -->
					<div style='float:left; width: 320px; height: 320px;'>
		                <canvas id="canvasEdit" class="canvasclass" width="300" height="300" tabindex="1"></canvas>
					</div>
					
			</div>

			<!-- Left eye -->
			<div style ="height: 160px; float:left;">
			
				<!-- Grading selects -->
				<p>Retinopathy:</p>
		        <select style="width:100px;" id="retGrade" onchange="gradeChange(this);">
                    <option value="R0">R0</option>
                    <option value="R1">R1</option>
                    <option value="R2">R2</option>
                    <option value="R3S">R3S</option>
                    <option value="R3A">R3A</option>
                    <option value="U">U</option>
                </select>
                <br />
                <p style="margin-top:10px; height:100px;" id="retGradeDesc">No retinopathy</p>
                <br />

				<p>Maculopathy:</p>
                <select style="width:100px;" id="macGrade" onchange="gradeChange(this);">
                    <option value="M0">M0</option>
                    <option value="M1">M1</option>
                </select>
                <br />
                <p style="margin-top:10px; height:120px;" id="macGradeDesc">No maculopathy</p>
                <br />
                
                <a href="javascript:void(0);" title="Example photographs" onClick="showPop('grading');">Examples</a>
				<span style="position:relative;">
					<span id='grading' class="popup">
						<img width="400px;" src="examples.jpg" onClick="hidePop('grading');">
					</span>
				</span>	         
					
			</div>
			
		<!-- End of Edit mode section -->
		</div>					

		<!-- Display mode section -->
		<div class="section" style="height:1600px;" align="left">
			<h2>Features based grading:</h2>
			
			<div style ="width: 740px; float:left;">

					<h4 style="margin-left:20px;">Advanced diabetic eye disease</h4>
					<table cellspacing="0" width="540" >
						<tbody>		
							<tr style="display:block;">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Advanced disease:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_adv" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>		
							<tr style="display:none; margin-left:60px;" id="advinv">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Iris neovascularisation:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_inv" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="advanv">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Angle neovascularisation:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_anv" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="advnvg">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Neovascular glaucoma:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_nvg" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="advtrd">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Traction retinal detachment:</p></td>
								<td align="left" width="40%">
									<select id="slt_trd" style="width:auto;">
							            <option>No</option>
							            <option>Fovea not threatened</option>
							            <option>Traction on fovea</option>
							            <option>Detached fovea</option>
							            <option>Combined TRD/RRD</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
						</tbody>
					</table>
					
					<h4 style="margin-left:20px;">Proliferative diabetic retinopathy</h4>
					<table cellspacing="0" width="540" >
						<tbody>							
							<tr style="display:block;">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Proliferative features:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_prl" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlvhm">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Vitreous haemorrhage:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_vhm" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlprh">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Pre-retinal haemorrhage:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_prh" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlnvd">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Disc new vessels:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_nvd" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="nvddes">
								<td align="left" width="40%"><p class="lable" style="width:240px;" ></p></td>
								<td align="left" width="40%">
									<select style="width:auto;">
							            <option>NVD Forward</option>
							            <option>NVD Flat</option>
								    </select>
									<select style="width:auto;">
							            <option>&lt; 1/3 disc area</option>
							            <option>&gt; 1/3 disc area</option>
								    </select>								
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlnve">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >New vessels elsewhere:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_nve" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="nvedes">
								<td align="left" width="40%"><p class="lable" style="width:240px;" ></p></td>
								<td align="left" width="40%">
									<select style="width:auto;">
							            <option>&lt; 1/2 disc area</option>
							            <option>&gt; 1/2 disc area</option>
								    </select>								
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlprp">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Panretinal photocoagulation:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_prp" onClick="clickChange(this);"/>
						        </td>
						       <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlrtt">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Response to treatment:</p></td>
								<td align="left" width="40%">
									<select id="slt_rtt" style="width:auto;">
							            <option>No previous treatment</option>
							            <option>Active</option>
							            <option>Partially regressed</option>
							            <option>Regressed</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="prlcms">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Comments:</p></td>
								<td align="left" width="40%">
									<textarea></textarea>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
						</tbody>
					</table>
					
					<h4 style="margin-left:20px;">Non-proliferative features</h4>
					<table cellspacing="0" width="540" >
						<tbody>	
							<tr style="display:block" id="nprirm">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >IRMA:</p></td>
								<td align="left" width="40%">
									<select id="slt_irm" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value="None">None</option>
							            <option value="1 quadrant">1 quadrant</option>
							            <option value="2 quadrant">2 quadrants</option>
							            <option value="3 quadrant">3 quadrants</option>
							            <option value="4 quadrant">4 quadrants</option>
							        </select>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optirm">(Optional)</p></td>
							</tr>
							<tr style="display:block;" id="nprims">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >IRMA severity greater than standard photo:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_ims" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optirs">(Optional)</p></td>
							</tr>
							<tr style="display:block" id="nprvbd">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Venous beading:</p></td>
								<td align="left" width="40%">
									<select id="slt_vbd" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value="None">None</option>
							            <option value="1 quadrant">1 quadrant</option>
							            <option value="2 or more quadrants">2 or more quadrants</option>
							        </select>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optvbd">(Optional)</p></td>
							</tr>
							<tr style="display:block;" id="nprvlp">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Venous loops:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_ims" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optvlp">(Optional)</p></td>
							</tr>
							<tr style="display:block" id="nprvmas">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >H/MAs:</p></td>
								<td align="left" width="40%">
									<select id="slt_mas" style="width:120px;" onchange="gradeFBCalculator();">
										<option value=0>None</option>
							            <option value=1>Ma only</option>
							            <option value=2>H/Ma &lt; next level</option>
							            <option value=3>&gt;= 4 blot heams in any quadrant and &gt;= 8 in total</option>
							            <option value=4>&gt; 2a in any quadrant</option>
							            <option value=5>&gt; 2a in all quadrants</option>
							        </select>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optmas">(Optional)</p></td>
							</tr>
							<tr style="display:block" id="nprvcws">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Cotton wool spots:</p></td>
								<td align="left" width="40%">
									<select id="slt_cws" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value=0>None</option>
							            <option value=1>&lt; 5</option>
							            <option value=2>&gt; 5</option>
							        </select>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optcws">(Optional)</p></td>
							</tr>									
						</tbody>
					</table>
	
					<h4 style="margin-left:20px;">Maculopathy</h4>
					<table cellspacing="0" width="540" >
						<tbody>	
							<tr style="display:block" id="macmas">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Haems/Mas:</p></td>
								<td align="left" width="40%">
									<select id="slt_mma" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value=0>None</option>
							            <option value=1>&lt;= 500um from centre</option>
							            <option value=2>&gt; 500um to 1DD from centre</option>
							            <option value=3>&gt; 1DD from centre</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:block" id="macexu">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Exudates:</p></td>
								<td align="left" width="40%">
									<select id="slt_exu" style="width:auto;" onchange="gradeFBCalculator();"> 
							            <option value=0>None</option>
							            <option value=1>Under fovea</option>
							            <option value=2>&lt; 500um from centre</option>
							            <option value=3>&lt; 1DD from centre</option>
							            <option value=4>&gt; 1DD from centre</option>
							            <option value=5>Groups &gt; 1DD from centre</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:block" id="macres">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Response to treatment:</p></td>
								<td align="left" width="40%">
									<select id="slt_res" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value=0>None</option>
							            <option value=1>Exudates resolved</option>
							            <option value=2>Exudates reduced</option>
							            <option value=3>Exudates unchanged</option>
							            <option value=4>Exudates increased</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							
							<tr style="display:block;" id="macthk">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Retinal thickening:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_thk" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:none" id="optvlp">(Optional)</p></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="maccmo">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Cystoid macular oedema:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_cmo" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="maccen">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >At centre of fovea:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_cen" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="macwit">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Within 500um of centre:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_wit" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="maczon">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Zone or zones one disc area or larger, any part of which is within one disc diameter of the centre of the macula:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_zon" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="maczth">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Exudates at or within 500 microns of the centre of the macula, if associated with thickening of the adjacent retina:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_zth" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:none; margin-left:60px;" id="macmns">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Macular oedema but no CSMO:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_mns" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							
							<tr style="display:block;" id="macerm">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Epiretinal membrane:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_erm" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:block" id="optvlp">(Optional)</p></td>
							</tr>
							<tr style="display:block;" id="macvmt">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Vitreomacular traction:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_vmt" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:block" id="optvmt">(Optional)</p></td>
							</tr>	
							<tr style="display:block;" id="mactau">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Taut thickened posterior hyaloid:</p></td>
								<td align="left" width="40%">
									<input class="checkbox" type="checkbox" id="chk_tau" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:block" id="opttau">(Optional)</p></td>
							</tr>
							<tr style="display:block" id="macplm">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Post-laser macular signs:</p></td>
								<td align="left" width="40%">
									<select id="slt_plm" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value=0>No laser spots visible (ENSPDR P0)</option>
							            <option value=1>laser scars visible (ENSPDR P)</option>
							            <option value=2>Burn creep under fovea</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:block" id="mactrs">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Thickening response to treatment:</p></td>
								<td align="left" width="40%">
									<select id="slt_trs" style="width:auto;" onchange="gradeFBCalculator();">
							            <option value=0>Resolved</option>
							            <option value=1>Reduced</option>
							            <option value=2>Unchanged</option>
							            <option value=3>Increased</option>
							        </select>
						        </td>
						        <td align="left" width="20%"></td>
							</tr>
							<tr style="display:block" id="maccft">
								<td align="left" width="40%"><p class="lable" style="width:240px;" >Central foveal thickness:</p></td>
								<td align="left" width="40%">
									<input class="textbox" onClick="clickChange(this);"/>
						        </td>
						        <td align="left" width="20%"><p class="lable" style="display:block" id="opttau">(Optional)</p></td>
							</tr>											
						</tbody>
					</table>

			</div>

			<!-- Left eye -->
			<div style ="width: 340px; float:left;">
				<!-- Grading selects -->
				<p>English National Screening Programme retinopathy grade:</p>
		        <select style="width:100px;" id="retGradeFB" onchange="gradeFBChange(this);">
                    <option value="R0">R0</option>
                    <option value="R1">R1</option>
                    <option value="R2">R2</option>
                    <option value="R3S">R3S</option>
                    <option value="R3A">R3A</option>
                    <option value="U">U</option>
                </select>
                <br />
                <!-- <p style="margin-top:10px; width:400px; height:100px;" id="retGradeFBDesc">No retinopathy</p> -->
                <br />

				<p>English National Screening Programme maculopathy grade:</p>
                <select style="width:100px;" id="macGradeFB" onchange="gradeFBChange(this);">
                    <option value="M0">M0</option>
                    <option value="M1">M1</option>
                </select>
                <br />
                <!-- <p style="margin-top:10px; width:400px; height:120px;" id="macGradeFBDesc">No maculopathy</p> -->
                <br />			
			</div>
			
		<!-- End of Display mode section -->
		</div>	

		<!-- Steering Group -->			
		<div class="section" align="left">
			<h4>Steering Group:</h4>
			<p>Cataract</p>
		</div>
		
		<!-- Blank Line -->
		<div class="section">
		</div>

	</div>
</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26543772-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
